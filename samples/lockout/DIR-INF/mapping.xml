<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapping PUBLIC
  "-//Penrose/DTD Mapping ${product.specification}//EN"
  "http://penrose.safehaus.org/dtd/mapping.dtd">

<mapping>

  <entry dn="dc=my-domain,dc=com">
    <entry-class>org.safehaus.penrose.directory.ProxyEntry</entry-class>
    <source name="LDAP">
      <source-name>LDAP</source-name>
    </source>
    <aci subject="self">
      <permission>rws</permission>
    </aci>
    <aci>
      <target>ATTRIBUTES</target>
      <attributes>userPassword</attributes>
      <action>deny</action>
      <permission>rs</permission>
    </aci>
    <aci>
      <permission>rs</permission>
    </aci>
  </entry>

  <entry dn="cn=lockout">
    <oc>extensibleObject</oc>
    <at name="cn" rdn="true">
      <constant>lockout</constant>
    </at>
  </entry>

  <entry dn="account=...,cn=lockout">
    <oc>extensibleObject</oc>
    <at name="account" rdn="true">
      <variable>l.account</variable>
    </at>
    <at name="counter">
      <variable>l.counter</variable>
    </at>
    <at name="timestamp">
      <expression>
return org.safehaus.penrose.lockout.Lock.DATE_FORMAT.format(l.timestamp);
      </expression>
    </at>
    <source name="l">
      <source-name>locks</source-name>
      <field name="account">
        <variable>account</variable>
      </field>
      <field name="counter">
        <variable>counter</variable>
      </field>
      <field name="timestamp">
        <variable>
return new java.sql.Timestamp(org.safehaus.penrose.lockout.Lock.DATE_FORMAT.parse(timestamp));
        </variable>
      </field>
    </source>
  </entry>

</mapping>
