<?xml version="1.0" encoding="UTF-8"?>

<mapping>
  <entry dn="dc=Example,dc=com">
    <oc>dcObject</oc>
    <oc>organization</oc>
    <at name="dc" rdn="true">
      <expression>"Example"</expression>
    </at>
    <at name="o">
      <expression>"Example"</expression>
    </at>
    <aci>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="description">
      <expression>cat.name</expression>
    </at>
    <at name="price">
      <expression>products.price</expression>
    </at>
    <source name="cat">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = cat.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Products,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <at name="description">
      <expression>categories.description</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <expression>description</expression>
      </field>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <at name="description">
      <expression>categories.description</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <expression>description</expression>
      </field>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="price">
      <expression>products.price</expression>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>categories.id = products.categoryId</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <expression>orders.date</expression>
    </at>
    <at name="orderId" rdn="true">
      <expression>orders.id</expression>
    </at>
    <at name="uid">
      <expression>orders.username</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="date">
        <expression>date</expression>
      </field>
      <field name="id">
        <expression>orderId</expression>
      </field>
      <field name="username">
        <expression>uid</expression>
      </field>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Customers"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Customers,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
    <relationship>
      <expression>orders.username = customers.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Customers"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Customers,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <at name="sn">
      <expression>customers.lastName</expression>
    </at>
    <at name="uid">
      <expression>customers.username</expression>
    </at>
    <at name="userPassword">
      <expression>customers.password</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
      <field name="password">
        <expression>userPassword</expression>
      </field>
      <field name="username">
        <expression>uid</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <expression>orders.date</expression>
    </at>
    <at name="orderId" rdn="true">
      <expression>orders.id</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="date">
        <expression>date</expression>
      </field>
      <field name="id">
        <expression>orderId</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,orderId=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="price">
      <expression>products.price</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
      <field name="price">
        <expression>price</expression>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <at name="description">
      <expression>categories.description</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <expression>description</expression>
      </field>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="price">
      <expression>products.price</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
      <field name="price">
        <expression>price</expression>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <at name="description">
      <expression>categories.description</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <expression>description</expression>
      </field>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
    <aci>
      <action>deny</action>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="orderId=...,ou=Orders,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <expression>orders.date</expression>
    </at>
    <at name="orderId" rdn="true">
      <expression>orders.id</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="date">
        <expression>date</expression>
      </field>
      <field name="id">
        <expression>orderId</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Products,orderId=...,ou=Orders,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,orderId=...,ou=Orders,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="description">
      <expression>categories.name</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Families,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Families"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Families,dc=Example,dc=com">
    <oc>groupOfUniqueNames</oc>
    <at name="cn" rdn="true">
      <expression>customers.lastName</expression>
    </at>
    <at name="description">
      <expression>if (customers.firstName instanceof Collection) {
    return customers.firstName.size()+" members";
} else {
    return "1 member";
}</expression>
    </at>
    <at name="uniqueMember">
      <expression foreach="customers.firstName" var="x">"cn="+x+" "+customers.lastName+",ou=Customers,dc=Example,dc=com"</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression foreach="uniqueMember" var="x">int i = x.indexOf("=");
int j = x.indexOf(",");
return x.substring(i+1, j);</expression>
      </field>
      <field name="lastName">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Members,cn=...,ou=Families,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Members"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Members,cn=...,ou=Families,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers2.firstName+" "+customers2.lastName</expression>
    </at>
    <at name="sn">
      <expression>customers2.lastName</expression>
    </at>
    <at name="uid">
      <expression>customers2.username</expression>
    </at>
    <at name="userPassword">
      <expression>customers2.password</expression>
    </at>
    <source name="customers2">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
      <field name="password">
        <expression>userPassword</expression>
      </field>
      <field name="username">
        <expression>uid</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.lastName = customers2.lastName</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=Families,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,cn=...,ou=Families,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <expression>orders.date</expression>
    </at>
    <at name="orderId" rdn="true">
      <expression>orders.id</expression>
    </at>
    <at name="uid">
      <expression>orders.username</expression>
    </at>
    <source name="customers2">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="date">
        <expression>date</expression>
      </field>
      <field name="id">
        <expression>orderId</expression>
      </field>
      <field name="username">
        <expression>uid</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.lastName = customers2.lastName</expression>
    </relationship>
    <relationship>
      <expression>customers2.username = orders.username</expression>
    </relationship>
  </entry>
</mapping>