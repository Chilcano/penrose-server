<?xml version="1.0" encoding="UTF-8"?>

<mapping>
  <entry dn="dc=Example,dc=com">
    <oc>dcObject</oc>
    <oc>organization</oc>
    <at name="dc" rdn="true">
      <expression>"Example"</expression>
    </at>
    <at name="o">
      <expression>"Example"</expression>
    </at>
    <aci>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <at name="uid">
      <expression>products.id</expression>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>categories.id = products.categoryId</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
  </entry>
  <entry dn="uid=...,ou=Orders,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="description">
      <expression>orders.date</expression>
    </at>
    <at name="uid" rdn="true">
      <expression>orders.id</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <expression>uid</expression>
      </field>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Customers"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Customers,cn=...,ou=Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
    <relationship>
      <expression>orders.customerId = customers.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Customers"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>orders.id</expression>
    </at>
    <at name="description">
      <expression>orders.date</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.id = orders.customerId</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Products,cn=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Products,cn=...,ou=Orders,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.id = orders.customerId</expression>
    </relationship>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Categories"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Customers,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>categories.name</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.id = orders.customerId</expression>
    </relationship>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Orders"</expression>
    </at>
    <aci>
      <action>deny</action>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="cn=...,ou=Orders,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>orders.id</expression>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Products,cn=...,ou=Orders,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <at name="ou" rdn="true">
      <expression>"Products"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=Orders,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>products.name</expression>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <expression>cn</expression>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Families,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Families"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Families,dc=Example,dc=com">
    <oc>groupOfUniqueNames</oc>
    <at name="cn" rdn="true">
      <expression>customers.lastName</expression>
    </at>
    <at name="uniqueMember">
      <expression foreach="customers.firstName">"cn="+customers.firstName+" "+customers.lastName+",ou=Customers,dc=Example,dc=com"</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="lastName">
        <expression>cn</expression>
      </field>
    </source>
  </entry>
  <entry dn="ou=Members,cn=...,ou=Families,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <expression>"Members"</expression>
    </at>
  </entry>
  <entry dn="cn=...,ou=Members,cn=...,ou=Families,dc=Example,dc=com">
    <oc>inetOrgPerson</oc>
    <oc>organizationalPerson</oc>
    <oc>person</oc>
    <at name="cn" rdn="true">
      <expression>customers2.firstName+" "+customers2.lastName</expression>
    </at>
    <source name="customers2">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
    </source>
    <relationship>
      <expression>customers.lastName = customers2.lastName</expression>
    </relationship>
  </entry>
</mapping>