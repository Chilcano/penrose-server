<?xml version="1.0" encoding="UTF-8"?>

<mapping>
  <entry dn="dc=Example,dc=com">
    <oc>dcObject</oc>
    <oc>organization</oc>
    <at name="dc" rdn="true">
      <constant>Example</constant>
    </at>
    <at name="o">
      <constant>Example</constant>
    </at>
    <aci>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Products</constant>
    </at>
  </entry>
  <entry dn="ou=All Products,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>All Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=All Products,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="description">
      <variable>cat.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <at name="info">
      <constant>All Products</constant>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
      <field name="price">
        <variable>price</variable>
      </field>
    </source>
    <source name="cat">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>description</variable>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = cat.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=All Products,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Categories</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=All Products,ou=Products,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <variable>categories.name</variable>
    </at>
    <at name="description">
      <variable>categories.description</variable>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <variable>description</variable>
      </field>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Prices,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Prices</constant>
    </at>
  </entry>
  <entry dn="price=...,ou=Prices,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="price" rdn="true">
      <expression>"$"+products.price</expression>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="price">
        <expression>if (price == void || price == null) return null;
return price.substring(1);</expression>
      </field>
    </source>
  </entry>
  <entry dn="cn=...,price=...,ou=Prices,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products2.name</variable>
    </at>
    <at name="price">
      <variable>products2.price</variable>
    </at>
    <source name="products2">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <relationship>
      <expression>products2.price = products.price</expression>
    </relationship>
  </entry>
  <entry dn="ou=Price Ranges,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Price Ranges</constant>
    </at>
  </entry>
  <entry dn="price=...,ou=Price Ranges,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="price" rdn="true">
      <expression foreach="products.price" var="x">"$"+x+" or under"</expression>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="price">
        <expression>if (price == void || price == null) return;
int i = price.indexOf(" ");
return price.substring(1, i);</expression>
      </field>
    </source>
  </entry>
  <entry dn="cn=...,price=...,ou=Price Ranges,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products2.name</variable>
    </at>
    <at name="price">
      <variable>products2.price</variable>
    </at>
    <source name="products2">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <relationship>
      <expression>products2.price &lt;= products.price</expression>
    </relationship>
  </entry>
  <entry dn="ou=Expensive Products,ou=Products,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Expensive Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Expensive Products,ou=Products,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <at name="info">
      <constant>Expensive Products</constant>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
      <parameter>
        <param-name>filter</param-name>
        <param-value>(price&gt;=5.0)</param-value>
      </parameter>
    </source>
  </entry>
  <entry dn="ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Categories</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <variable>categories.name</variable>
    </at>
    <at name="description">
      <variable>categories.description</variable>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <variable>description</variable>
      </field>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
  </entry>
  <entry dn="ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>All Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="description">
      <variable>categories.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <relationship>
      <expression>categories.id = products.categoryId</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Orders</constant>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,cn=...,ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <variable>orders.orderDate</variable>
    </at>
    <at name="orderId" rdn="true">
      <variable>orders.id</variable>
    </at>
    <at name="uid">
      <variable>orders.username</variable>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <variable>orderId</variable>
      </field>
      <field name="orderDate">
        <variable>date</variable>
      </field>
      <field name="username">
        <variable>uid</variable>
      </field>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,cn=...,ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Customers</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Customers,cn=...,ou=All Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <at name="sn">
      <variable>customers.lastName</variable>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
if (i &lt; 0) return null;
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>if (sn != void &amp;&amp; sn != null) return sn;
if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
return cn.substring(i+1);</expression>
      </field>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>products.id = order_details.productId</expression>
    </relationship>
    <relationship>
      <expression>order_details.orderId = orders.id</expression>
    </relationship>
    <relationship>
      <expression>orders.username = customers.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Expensive Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Expensive Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Expensive Products,cn=...,ou=Categories,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
      <parameter>
        <param-name>filter</param-name>
        <param-value>(price&gt;=5.0)</param-value>
      </parameter>
    </source>
    <relationship>
      <expression>categories.id = products.categoryId</expression>
    </relationship>
  </entry>
  <entry dn="ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Customers</constant>
    </at>
  </entry>
  <entry dn="ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>All Customers</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers.firstName+" "+customers.lastName</expression>
    </at>
    <at name="mail">
      <variable>customer_emails.email</variable>
    </at>
    <at name="sn">
      <variable>customers.lastName</variable>
    </at>
    <at name="uid">
      <variable>customers.username</variable>
    </at>
    <at name="userPassword">
      <expression>import org.safehaus.penrose.util.*;

if (customers.encPassword == void || customers.encPassword == null) return null;

byte[] bytes = PasswordUtil.decode("BigInteger", customers.encPassword);
return "{SHA}"+PasswordUtil.encode("Base64", bytes);</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="encPassword">
        <expression>import org.safehaus.penrose.util.*;

if (userPassword == void || userPassword == null) return null;

byte[] bytes;

String method = PasswordUtil.getEncryptionMethod(userPassword);
if (method == null) {
    bytes = PasswordUtil.encrypt("SHA", userPassword);

} else if ("SHA".equals(method)) {
    String password = PasswordUtil.getEncryptedPassword(userPassword);
    bytes = PasswordUtil.decode("Base64", password);

} else {
    throw new Exception("Unsupported encryption: "+method);
}

return PasswordUtil.encode("BigInteger", bytes);</expression>
      </field>
      <field name="firstName">
        <expression>if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
if (i &lt; 0) return null;
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>if (sn != void &amp;&amp; sn != null) return sn;
if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
if (i &lt; 0) return null;
return cn.substring(i+1);</expression>
      </field>
      <field name="username">
        <variable>uid</variable>
      </field>
    </source>
    <source name="customer_emails" required="false">
      <source-name>customer_emails</source-name>
      <connection-name>MySQL</connection-name>
      <field name="email">
        <variable>mail</variable>
      </field>
    </source>
    <relationship>
      <expression>customers.username = customer_emails.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Orders</constant>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <variable>orders.orderDate</variable>
    </at>
    <at name="orderId" rdn="true">
      <variable>orders.id</variable>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <variable>orderId</variable>
      </field>
      <field name="orderDate">
        <variable>date</variable>
      </field>
    </source>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,orderId=...,ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
      <field name="price">
        <variable>price</variable>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Categories</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=Products,orderId=...,ou=Orders,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <variable>categories.name</variable>
    </at>
    <at name="description">
      <variable>categories.description</variable>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <variable>description</variable>
      </field>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Products,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="price">
      <variable>products.price</variable>
    </at>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
      <field name="price">
        <variable>price</variable>
      </field>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Categories,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Categories</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Categories,cn=...,ou=All Customers,ou=Customers,dc=Example,dc=com">
    <oc>category</oc>
    <at name="cn" rdn="true">
      <variable>categories.name</variable>
    </at>
    <at name="description">
      <variable>categories.description</variable>
    </at>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
      <field name="description">
        <variable>description</variable>
      </field>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
    <relationship>
      <expression>customers.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Families</constant>
    </at>
  </entry>
  <entry dn="sn=...,ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>groupOfUniqueNames</oc>
    <at name="description">
      <expression>if (customers.firstName instanceof Collection) {
    return customers.firstName.size()+" members";
} else {
    return "1 member";
}</expression>
    </at>
    <at name="sn" rdn="true">
      <variable>customers.lastName</variable>
    </at>
    <at name="uniqueMember">
      <expression foreach="customers.firstName" var="x">"cn="+x+" "+customers.lastName+",ou=Customers,dc=Example,dc=com"</expression>
    </at>
    <source name="customers">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression foreach="uniqueMember" var="x">int i = x.indexOf("=");
int j = x.indexOf(",");
return x.substring(i+1, j);</expression>
      </field>
      <field name="lastName">
        <variable>sn</variable>
      </field>
    </source>
  </entry>
  <entry dn="ou=Members,sn=...,ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Members</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Members,sn=...,ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>customer</oc>
    <at name="cn" rdn="true">
      <expression>customers2.firstName+" "+customers2.lastName</expression>
    </at>
    <at name="sn">
      <variable>customers2.lastName</variable>
    </at>
    <at name="uid">
      <variable>customers2.username</variable>
    </at>
    <at name="userPassword">
      <variable>customers2.password</variable>
    </at>
    <source name="customers2">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
      <field name="firstName">
        <expression>if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
if (i &lt; 0) return null;
return cn.substring(0, i);</expression>
      </field>
      <field name="lastName">
        <expression>if (sn != void &amp;&amp; sn != null) return sn;
if (cn == void || cn == null) return null;
int i = cn.indexOf(" ");
if (i &lt; 0) return null;
return cn.substring(i+1);</expression>
      </field>
      <field name="password">
        <variable>userPassword</variable>
      </field>
      <field name="username">
        <variable>uid</variable>
      </field>
    </source>
    <relationship>
      <expression>customers.lastName = customers2.lastName</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,sn=...,ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Orders</constant>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Orders,sn=...,ou=Families,ou=Customers,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <variable>orders.orderDate</variable>
    </at>
    <at name="orderId" rdn="true">
      <variable>orders.id</variable>
    </at>
    <at name="uid">
      <variable>orders.username</variable>
    </at>
    <source name="customers2">
      <source-name>customers</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <variable>orderId</variable>
      </field>
      <field name="orderDate">
        <variable>date</variable>
      </field>
      <field name="username">
        <variable>uid</variable>
      </field>
    </source>
    <relationship>
      <expression>customers.lastName = customers2.lastName</expression>
    </relationship>
    <relationship>
      <expression>customers2.username = orders.username</expression>
    </relationship>
  </entry>
  <entry dn="ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Orders</constant>
    </at>
    <aci>
      <action>deny</action>
      <permission>rs</permission>
    </aci>
  </entry>
  <entry dn="ou=All Orders,ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>All Orders</constant>
    </at>
  </entry>
  <entry dn="orderId=...,ou=All Orders,ou=Orders,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <variable>orders.orderDate</variable>
    </at>
    <at name="orderId" rdn="true">
      <variable>orders.id</variable>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <variable>orderId</variable>
      </field>
      <field name="orderDate">
        <variable>date</variable>
      </field>
    </source>
  </entry>
  <entry dn="ou=Products,orderId=...,ou=All Orders,ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Products</constant>
    </at>
  </entry>
  <entry dn="cn=...,ou=Products,orderId=...,ou=All Orders,ou=Orders,dc=Example,dc=com">
    <oc>product</oc>
    <at name="cn" rdn="true">
      <variable>products.name</variable>
    </at>
    <at name="description">
      <variable>categories.name</variable>
    </at>
    <source name="products">
      <source-name>products</source-name>
      <connection-name>MySQL</connection-name>
      <field name="name">
        <variable>cn</variable>
      </field>
    </source>
    <source name="order_details">
      <source-name>order_details</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <source name="categories">
      <source-name>categories</source-name>
      <connection-name>MySQL</connection-name>
    </source>
    <relationship>
      <expression>orders.id = order_details.orderId</expression>
    </relationship>
    <relationship>
      <expression>order_details.productId = products.id</expression>
    </relationship>
    <relationship>
      <expression>products.categoryId = categories.id</expression>
    </relationship>
  </entry>
  <entry dn="ou=Recent Orders,ou=Orders,dc=Example,dc=com">
    <oc>organizationalUnit</oc>
    <at name="ou" rdn="true">
      <constant>Recent Orders</constant>
    </at>
  </entry>
  <entry dn="orderId=...,ou=Recent Orders,ou=Orders,dc=Example,dc=com">
    <oc>order</oc>
    <at name="date">
      <variable>orders.orderDate</variable>
    </at>
    <at name="orderId" rdn="true">
      <variable>orders.id</variable>
    </at>
    <source name="orders">
      <source-name>orders</source-name>
      <connection-name>MySQL</connection-name>
      <field name="id">
        <variable>orderId</variable>
      </field>
      <field name="orderDate">
        <variable>date</variable>
      </field>
      <parameter>
        <param-name>filter</param-name>
        <param-value>(orderDate&gt;=2005-06-01)</param-value>
      </parameter>
    </source>
  </entry>
</mapping>
