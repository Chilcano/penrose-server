<!--
 Copyright (c) 2000-2005, Identyx Corporation.
 All rights reserved.
-->
<project name="openldap-servers-java" default="dist">

    <property name="prefix" value=""/>

    <property name="project.name" value="openldap-servers-java"/>
    <property name="project.version" value="2.2.29"/>
    <property name="project.dist" value="dist"/>
    <property name="project.home" value="${prefix}/usr/sbin/openldap"/>

    <property name="rpm.prefix" value=""/>
    <property name="rpm.home" value="/usr/src/redhat"/>
    <property name="rpm.builder" value="/usr/bin/rpmbuild"/>

    <property name="ln" value="/bin/ln"/>

    <target name="dist">

        <mkdir dir="target"/>

        <tar destfile="target/${project.name}-${project.version}-src.tar">
            <tarfileset dir="." prefix="${project.name}-${project.version}" mode="755">
                <include name="linux/**"/>
            </tarfileset>
            <tarfileset dir="." prefix="${project.name}-${project.version}">
                <include name="build.xml"/>
            </tarfileset>
        </tar>

        <mkdir dir="dist"/>

        <gzip
            destfile="${project.dist}/${project.name}-${project.version}-src.tar.gz"
            src="target/${project.name}-${project.version}-src.tar"
        />

    </target>

    <target name="dist-rpm" depends="dist">

        <mkdir dir="dist"/>

        <copy todir="${rpm.home}/SOURCES" overwrite="true"
            file="${project.dist}/${project.name}-${project.version}-src.tar.gz">
        </copy>

        <copy todir="target" file="${project.name}-${project.version}.spec">
            <filterchain>
                <expandproperties/>
            </filterchain>
        </copy>

        <exec executable="${rpm.builder}">
            <arg line="-ba target/${project.name}-${project.version}.spec"/>
        </exec>

        <copy todir="${project.dist}" failonerror="false"
            file="${rpm.home}/SRPMS/${project.name}-${project.version}-1.FC3.src.rpm">
        </copy>
        <copy todir="${project.dist}" failonerror="false"
            file="${rpm.home}/RPMS/i386/${project.name}-${project.version}-1.FC3.i386.rpm">
        </copy>

    </target>

    <target name="install">

        <mkdir dir="${project.home}"/>

        <copy todir="${project.home}">
            <fileset dir="linux"/>
        </copy>

        <chmod dir="${project.home}" perm="ugo+rx" includes="**/*"/>

        <exec executable="${ln}">
            <arg line="-sf back_java-2.2.so.7.0.22 ${project.home}/back_java-2.2.so.7"/>
        </exec>

    </target>

    <target name="clean">
        <delete dir="target" failonerror="false"/>
        <delete dir="dist" failonerror="false"/>
    </target>

</project>
